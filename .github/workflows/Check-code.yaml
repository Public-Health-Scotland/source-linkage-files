# Workflow derived from https://github.com/r-lib/actions/tree/master/examples
# Need help debugging build failures? Start at https://github.com/r-lib/actions#where-to-find-help
on:
 pull_request:
  branches: [main-R]

name: Check

jobs:
 document-style:
  name: Document and style
  runs-on: ubuntu-latest
  env:
   GITHUB_PAT: ${{ secrets.GITHUB_TOKEN }}
  steps:
   - uses: actions/checkout@v2

   - uses: r-lib/actions/pr-fetch@v1
     with:
      repo-token: ${{ secrets.GITHUB_TOKEN }}

   - uses: r-lib/actions/setup-r@v1
     with:
      use-public-rspm: true

   - uses: r-lib/actions/setup-r-dependencies@v1
     with:
      extra-packages: roxygen2, styler

   - name: Document
     run: Rscript -e 'roxygen2::roxygenise()'

   - name: commit
     run: |
      git config --local user.name "$GITHUB_ACTOR"
      git config --local user.email "$GITHUB_ACTOR@users.noreply.github.com"
      git add man/\* NAMESPACE
      git commit -m 'Document'
   - uses: r-lib/actions/pr-push@v1
     with:
      repo-token: ${{ secrets.GITHUB_TOKEN }}
      
   - name: Style
     run: Rscript -e 'styler::style_pkg()'

   - name: commit
     run: |
      git config --local user.name "$GITHUB_ACTOR"
      git config --local user.email "$GITHUB_ACTOR@users.noreply.github.com"
      git add \*.R
      git commit -m 'Style'
   - uses: r-lib/actions/pr-push@v1
     with:
      repo-token: ${{ secrets.GITHUB_TOKEN }}

 lint:
  needs: document-style
  runs-on: ubuntu-latest
  env:
   GITHUB_PAT: ${{ secrets.GITHUB_TOKEN }}
  steps:
   - uses: actions/checkout@v2

   - uses: r-lib/actions/setup-r@v1
     with:
      use-public-rspm: true

   - uses: r-lib/actions/setup-r-dependencies@v1
     with:
      extra-packages: lintr

   - name: Lint
     run: lintr::lint_package()
     shell: Rscript {0}
