<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>03 Package Development â€¢ createslf</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="03 Package Development">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">createslf</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/project_structure.html">01 Project Structure</a></li>
    <li><a class="dropdown-item" href="../articles/using_github.html">02 Using GitHub to Develop createslf</a></li>
    <li><a class="dropdown-item" href="../articles/package_development.html">03 Package Development</a></li>
    <li><a class="dropdown-item" href="../articles/data_table.html">04 Improve efficiency with `data.table`</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Public-Health-Scotland/source-linkage-files/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>03 Package Development</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Public-Health-Scotland/source-linkage-files/blob/master/vignettes/package_development.Rmd" class="external-link"><code>vignettes/package_development.Rmd</code></a></small>
      <div class="d-none name"><code>package_development.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="background">Background<a class="anchor" aria-label="anchor" href="#background"></a>
</h2>
<p>The Source Linkage Files (SLFs) project was created using SPSS syntax
until March 2022 when this was transformed into R programming language.
The project has evolved into itâ€™s own R package called
<code>createslf</code> which contains functions for maintaining the
Reproducible Analytical Pipeline (RAP) to create the SLFs on a quarterly
basis.</p>
<p>The package bundles together code, data, documentation, and tests,
and is easy to share with others. To create the package
<code>createslf</code> we refer to the <a href="https://r-pkgs.org/introduction.html" class="external-link">R Packages</a> guide by
Hadley Wickham.</p>
<p>This package is intended to be in continuous development to support
the quarterly update process of the SLFs which takes place each March,
June, September and December.</p>
</div>
<div class="section level2">
<h2 id="developing-createslf---setup">Developing createslf - setup<a class="anchor" aria-label="anchor" href="#developing-createslf---setup"></a>
</h2>
<p>The <code>createslf</code> package has a clear structure for
development. There are a few important features which are essential for
the setup of the package:</p>
<ul>
<li>
<strong>README.md</strong> - Readme file contains important
information about the package.</li>
<li>
<strong>R/ directory</strong> - Main development folder where all
functions are stored. See the <a href="https://public-health-scotland.github.io/source-linkage-files/articles/R%20Project%20Structure.html">article</a>
for more information on function setup.</li>
<li>
<strong>DESCRIPTION file</strong> - The <strong>DESCRIPTION</strong>
file provides overall metadata about the package, such as the package
name and which other packages it depends on.</li>
<li>
<strong>NAMESPACE file</strong> - The <strong>NAMESPACE</strong>
file specifies which functions the package makes available for others to
use and, optionally, imports functions from other packages. This file is
generated automatically when the package is build and should not be
edited by hand. Changes should be made on individual functions by
editing the roxygen2 documentation.</li>
<li>
<strong>man/</strong> - Documentation is stored in the
<strong>man/</strong> directory. The documentation files are generated
automatically when the package is build and should not be edited by
hand. Changes should be made on individual functions by editing the
roxygen2 documentaiton.</li>
<li>
<strong>tests/</strong> - Package tests are stored in the
<strong>tests/</strong> directory. Testing is a vital part of package
development as it ensures that our code is working. Testing, however,
adds an additional step to the workflow. See chapter <a href="https://r-pkgs.org/testing-basics.html" class="external-link">testing basics</a> for
more info on package tests. Please note, this <strong>tests/</strong>
directory is completely separate to SLF quarterly tests and is intented
to test the functions within the <code>createslf</code> package.</li>
</ul>
<div class="section level3">
<h3 id="developing-a-new-function---best-practice">Developing a new function - Best Practice:<a class="anchor" aria-label="anchor" href="#developing-a-new-function---best-practice"></a>
</h3>
<ul>
<li>All function names should be in lower case, with words separated by
an underscore</li>
<li>Put a space after a comma, never before</li>
<li>Put a space before and after infix operators such as &lt;-, == and
+</li>
<li>Limit code to 80 characters per line</li>
<li>Function documentation should be generated using roxygen2</li>
<li>Functions should be tested using testthat where possible</li>
<li>The package should always pass devtools::check()</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="documentation">Documentation<a class="anchor" aria-label="anchor" href="#documentation"></a>
</h2>
<p>Function documentation is important for maintaining the package
<code>createslf</code>. For Hadley Wickhamâ€™s guide see this <a href="https://r-pkgs.org/man.html" class="external-link">chapter</a> on documentation.</p>
<p>In summary, documentation is important for each function as this is
where users will use the help page to search with
<code>?XXXfunction</code>.</p>
<p>The package <code>createslf</code> uses roxygen2 format for
documenting functions. Here are some of the advantages:</p>
<ul>
<li><p>Code and documentation are co-located. When you modify your code,
itâ€™s easy to remember to also update your documentation.</p></li>
<li><p>You can use markdown, rather than having to learn a one-off
markup language that only applies to <code>.Rd</code> files. In addition
to formatting, the automatic hyperlinking functionality makes it much,
much easier to create richly linked documentation.</p></li>
<li><p>Thereâ€™s a lot of <code>.Rd</code> boilerplate thatâ€™s automated
away.</p></li>
<li><p>roxygen2 provides a number of tools for sharing content across
documentation topics and even between topics and vignettes.</p></li>
</ul>
<p><em>Documentation example:</em></p>
<p>The function below comes from <strong>00-update_refs</strong> and
simply returns the delayed discharges period for the update as a
<code>STRING</code>. This is used in the set up of functions, allowing
the correct path to the latest delayed discharges extract. The
<em>roxygen2</em> documentation is well documented with:</p>
<ul>
<li><p><strong>Title</strong> - Title of function</p></li>
<li><p><strong>Description</strong> - Brief description of the functions
purpose.</p></li>
<li><p><strong>Return</strong> - What should the function
return?</p></li>
<li><p><strong>export</strong> - Include to export this during the
package load.</p></li>
<li><p><strong>family</strong> - Groups similar functions
together.</p></li>
</ul>
<p>As this function is already documented, a <code>.Rd</code> file will
exist in the <strong>man/</strong> folder. However, if there were any
changes to this function or if the documentation was updated, the
<code>.Rd</code> file would also need to be updated. To do this, you can
run <code>devtools::document()</code> to generate (or update) the
packageâ€™s .Rd files. The <code>.Rd</code> files should not be edited by
hand and should be done by running
<code>devtools::document()</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#' Delayed Discharge period</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @description Get the period for Delayed Discharge</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @return The period for the Delayed Discharge file</span></span>
<span><span class="co">#' as MMMYY_MMMYY</span></span>
<span><span class="co">#' @export</span></span>
<span><span class="co">#'</span></span>
<span><span class="co">#' @family initialisation</span></span>
<span><span class="va">get_dd_period</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">first_part</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="fu"><a href="../reference/previous_update.html">previous_update</a></span><span class="op">(</span><span class="op">)</span>, <span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span></span>
<span>  <span class="va">end_part</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="fu"><a href="../reference/previous_update.html">previous_update</a></span><span class="op">(</span><span class="op">)</span>, <span class="fl">7</span>, <span class="fl">8</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">dd_period</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_glue.html" class="external-link">str_glue</a></span><span class="op">(</span><span class="st">"Jul16_{first_part}{end_part}"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">dd_period</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="checking-an-r-package---r-cmd-check">Checking an R package - R CMD check<a class="anchor" aria-label="anchor" href="#checking-an-r-package---r-cmd-check"></a>
</h2>
<p>Base R provides various command line tools and R CMD check is the
official method for checking that an R package is valid. It is essential
to pass R CMD check if you plan to submit your package to CRAN, but we
highly recommend holding yourself to this standard even if you donâ€™t
intend to release your package on CRAN. R CMD check detects many common
problems that youâ€™d otherwise discover the hard way.</p>
<p>Our recommended way to run R CMD check is in the R console via
devtools:</p>
<p><code>devtools::check()</code></p>
<p>We recommend this because it allows you to run R CMD check from
within R, which dramatically reduces friction and increases the
likelihood that you will <code>check()</code> early and often! This
emphasis on fluidity and fast feedback is exactly the same motivation as
given for <code>load_all()</code>. In the case of check(), it really is
executing R CMD check for you. Itâ€™s not just a high fidelity simulation,
which is the case for <code>load_all()</code>.</p>
</div>
<div class="section level2">
<h2 id="workflows">Workflows<a class="anchor" aria-label="anchor" href="#workflows"></a>
</h2>
<p>The workflow for checking a package is simple, but tedious:</p>
<ul>
<li><p>Run <code>devtools::check()</code>, or press
<code>Ctrl/Cmd + Shift + E</code>.</p></li>
<li><p>Fix the first problem.</p></li>
<li><p>Repeat until there are no more problems.</p></li>
<li><p>R CMD check returns three types of messages:</p></li>
<li><p><strong>ERRORs:</strong> Severe problems that you should fix
regardless of whether or not youâ€™re submitting to CRAN.</p></li>
<li><p><strong>WARNINGs:</strong> Likely problems that you must fix if
youâ€™re planning to submit to CRAN (and a good idea to look into even if
youâ€™re not).</p></li>
<li><p><strong>NOTEs:</strong> Mild problems or, in a few cases, just an
observation. If you are submitting to CRAN, you should strive to
eliminate all NOTEs, even if they are false positives. If you have no
NOTEs, human intervention is not required, and the package submission
process will be easier. If itâ€™s not possible to eliminate a NOTE, youâ€™ll
need describe why itâ€™s OK in your submission comments, as described in
Section 22.7. If youâ€™re not submitting to CRAN, carefully read each
NOTE. If itâ€™s easy to eliminate the NOTEs, itâ€™s worth it, so that you
can continue to strive for a totally clean result. But if eliminating a
NOTE will have a net negative impact on your package, it is reasonable
to just tolerate it. Make sure that doesnâ€™t lead to you ignoring other
issues that really should be addressed.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="testing-the-package">Testing the package<a class="anchor" aria-label="anchor" href="#testing-the-package"></a>
</h2>
<p>Testing is a vital part of developing the <code>createslf</code> as
it ensures that the code does what we want. Testing, however, adds an
additional step to the workflow. Please see this <a href="https://r-pkgs.org/testing-basics.html" class="external-link">chapter</a> for more
information on setting up tests.</p>
<p><code>createslf</code> tests sit on the <code>tests/testthat/</code>
directory. To set up a new test you can run
<code>usethis::use_test()</code> to create a new test file.</p>
<p>To test the file run:
<code>testthat::test_file("tests/testthat/test-XXX.R")</code></p>
<div class="section level3">
<h3 id="expectations">Expectations<a class="anchor" aria-label="anchor" href="#expectations"></a>
</h3>
<p>An expectation is the finest level of testing. It makes a binary
assertion about whether or not an object has the properties you expect.
This object is usually the return value from a function in your
package.</p>
<p>All expectations have a similar structure:</p>
<ul>
<li><p>They start with <code>expect_</code>.</p></li>
<li><p>They have two main arguments: the first is the actual result, the
second is what you expect.</p></li>
<li><p>If the actual and expected results donâ€™t agree, testthat throws
an error.</p></li>
<li><p>Some expectations have additional arguments that control the
finer points of comparing an actual and expected result.</p></li>
</ul>
<p>An example of one of our tests is to check that the
<code>convert_ca_to_lca</code> function is working correctly and returns
the correct lca code.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://testthat.r-lib.org" class="external-link">testthat</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://public-health-scotland.github.io/source-linkage-files">createslf</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'createslf'</span></span>
<span><span class="co">#&gt; The following object is masked _by_ '.GlobalEnv':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     get_dd_period</span></span>
<span></span>
<span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_that.html" class="external-link">test_that</a></span><span class="op">(</span><span class="st">"Can convert ca code to lca code"</span>, <span class="op">{</span></span>
<span>  <span class="va">ca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"S12000033"</span>,</span>
<span>    <span class="st">"S12000049"</span>,</span>
<span>    <span class="st">"S12000048"</span>,</span>
<span>    <span class="cn">NA</span>,</span>
<span>    <span class="st">"S12345678"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://testthat.r-lib.org/reference/equality-expectations.html" class="external-link">expect_equal</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/convert_ca_to_lca.html">convert_ca_to_lca</a></span><span class="op">(</span><span class="va">ca</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="st">"01"</span>,</span>
<span>      <span class="st">"17"</span>,</span>
<span>      <span class="st">"25"</span>,</span>
<span>      <span class="cn">NA</span>,</span>
<span>      <span class="cn">NA</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">Test passed</span> ðŸ¥‡</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Public Health Scotland, Megan McNicol, Jennifer Thom, Zihao Li.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
