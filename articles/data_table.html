<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Improve efficiency with `data.table` • createslf</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Improve efficiency with `data.table`">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">createslf</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/data_table.html">Improve efficiency with `data.table`</a></li>
    <li><a class="dropdown-item" href="../articles/package_development.html">Package Development</a></li>
    <li><a class="dropdown-item" href="../articles/Project_structure.html">Project_structure</a></li>
    <li><a class="dropdown-item" href="../articles/using_github.html">Using Github to Develop createslf</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/Public-Health-Scotland/source-linkage-files/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Improve efficiency with `data.table`</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Public-Health-Scotland/source-linkage-files/blob/update_pkgdown/vignettes/data_table.Rmd" class="external-link"><code>vignettes/data_table.Rmd</code></a></small>
      <div class="d-none name"><code>data_table.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette shares techniques of working with big data within the
<a href="https://github.com/Public-Health-Scotland/source-linkage-files" class="external-link">Source
Linkage File (SLF) project</a>. I will introduce an R package,
<code>data.table</code>, on the basic syntax and some common data
operations. This package can speed up processes by reducing the time
consumption and memory usage. The objective of this vignette is to
explicate the application of <code>data.table</code> through
illustrative examples. Readers should be able to write
<code>data.table</code> syntax after reading this vignette. This
document aspires to promote optimization skills and techniques to a
broader audience within the Data and Digital Innovation (DDI) team and
across Public Health Scotland (PHS), thereby enhancing operational
efficiency.</p>
</div>
<div class="section level2">
<h2 id="showcases-of-efficiency-enhancement-in-the-source-linkage-file-project">Showcases of Efficiency Enhancement in the Source Linkage File
Project<a class="anchor" aria-label="anchor" href="#showcases-of-efficiency-enhancement-in-the-source-linkage-file-project"></a>
</h2>
<p>Efficiency improvement is paramount in data-intensive projects,
especially within public health. The SLF project at PHS has undertaken
optimization efforts to streamline processing workflows and reduce
computational overhead. This section showcases tangible efficiency
improvements achieved through these techniques.</p>
<p>With the help of <code>data.table</code>, the SLF team further has
achieved great improvement in enhancing code efficiency, notably in
terms of script execution time and memory utilization. Two illustrative
examples highlight the extent of improvement attained by the team.</p>
<div class="section level4">
<h4 class="unnumbered" id="example-1">Example 1<a class="anchor" aria-label="anchor" href="#example-1"></a>
</h4>
<p>The first example mainly shows the efficiency improvement with
<code>data.table</code> in script executing time. The details of this
example is on <a href="https://github.com/Public-Health-Scotland/source-linkage-files/pull/899" class="external-link">the
pull request #899 source linkage file project on GitHub</a>. A
comparison between the old and new methods, focusing on the functions
<code>process_sc_all_sds</code> and
<code>process_sc_all_alarms_telecare</code>, is presented below:</p>
<table style="width:100%;" class="table">
<colgroup>
<col width="35%">
<col width="21%">
<col width="26%">
<col width="16%">
</colgroup>
<thead><tr class="header">
<th>Function Name</th>
<th>Old Method <code>dplyr</code>
</th>
<th>New Method <code>data.table</code>
</th>
<th>Time Reduction</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>process_sc_all_sds</code></td>
<td>24.94 mins</td>
<td>1.69 mins</td>
<td>94% reduction</td>
</tr>
<tr class="even">
<td><code>process_sc_all_alarms_telecare</code></td>
<td>31.81 mins</td>
<td>0.81 mins</td>
<td>98% reduction</td>
</tr>
</tbody>
</table>
<p>Both functions yield identical results to their predecessors but
exhibit remarkable reductions in execution time. Notably,
<code>process_sc_all_sds</code> achieved a 94% reduction, while
<code>process_sc_all_alarms_telecare</code> demonstrated an even more
substantial 98% reduction, affirming the efficacy of the refined
functions in enhancing performance.</p>
</div>
<div class="section level4">
<h4 class="unnumbered" id="example-2">Example 2<a class="anchor" aria-label="anchor" href="#example-2"></a>
</h4>
<p>The second example showcases performance optimization in terms of
both memory usage and executing time. Further details regarding this
example can be found on <a href="https://github.com/Public-Health-Scotland/source-linkage-files/pull/677" class="external-link">the
pull request #677 the source linkage file project on GitHub</a>. To show
the efficiency improvement, a benchmark comparison were conducted
between the old version and the new version of the
<code>aggregate_by_chi</code> function. Benchmark results are based on a
test dataset with 10,000 (10^4) rows, as the complete benchmark on the
real dataset is constrained by time and resource limitations. Typically,
a real dataset consists of usually more than 10 million (10^7) rows for
a financial year. The summarized benchmark results for the test dataset
are as follows:</p>
<table class="table">
<colgroup>
<col width="31%">
<col width="15%">
<col width="10%">
<col width="20%">
<col width="22%">
</colgroup>
<thead><tr class="header">
<th>Function</th>
<th>Time</th>
<th>Memory</th>
<th>Time Reduction</th>
<th>Memory Reduction</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Old Method <code>dplyr</code>
</td>
<td>139.8 sec</td>
<td>953 MB</td>
<td>-</td>
<td>-</td>
</tr>
<tr class="even">
<td>New Method <code>data.table</code>
</td>
<td>18.38 sec</td>
<td>546 MB</td>
<td>92.1%</td>
<td>42.7%</td>
</tr>
</tbody>
</table>
<p>It’s noteworthy that these benchmarks were conducted on a test
dataset comprising 10,000 rows. Given that our actual data sets
typically have more than 10 million rows, we can estimate substantial
improvements in time and memory consumption when applying the new
function to real data sets. Although the exact reduction estimates for
the real data sets may vary, based on the observed improvements in the
benchmark results, we can anticipate a boost in performance and
efficiency at a similar level.</p>
</div>
</div>
<div class="section level2">
<h2 id="syntax-of-data-table-and-converting-dplyr-to-data-table">Syntax of <code>data.table</code> and converting dplyr to
<code>data.table</code><a class="anchor" aria-label="anchor" href="#syntax-of-data-table-and-converting-dplyr-to-data-table"></a>
</h2>
<p>In this section, our primary objective is to identify
resource-intensive scenarios prevalent in data analysis scripts within
the public health domain and demonstrate how the <code>data.table</code>
package can enhance efficiency without necessitating extensive
modifications to the original scripts or functions. We commence by
presenting fundamental <code>data.table</code> syntax. Subsequently, we
pinpoint instances where operations utilising <code>dplyr</code>
functions may exhibit resource-intensive behaviour and illustrate how
integration with <code>data.table</code> techniques can ameliorate such
issues. It is essential to emphasize that our aim is not to entirely
supplant <code>dplyr</code> code with <code>data.table</code>
equivalents. Instead, we seek to identify scenarios where leveraging
<code>data.table</code> can substantially mitigate execution time and
memory usage of R scripts, thereby justifying the conversion of select
portions from <code>dplyr</code> to <code>data.table</code> syntax while
maintaining overall consistency with the <code>dplyr</code> approach.
These scenarios encompass:</p>
<ul>
<li>grouped operations on large datasets</li>
<li>joining large datasets</li>
<li>reshaping dataset</li>
<li>conditional updates</li>
</ul>
<p>This is served with some dummy examples to demonstrate the ideas,
providing insight into where and how one can enhance their own R
scripts.</p>
<div class="section level3">
<h3 id="data-table-package-and-syntax">data.table` package and syntax<a class="anchor" aria-label="anchor" href="#data-table-package-and-syntax"></a>
</h3>
<p><code>data.table</code> can do fast aggregation of large data
(e.g. 100GB in RAM), fast ordered joins, fast add/modify/delete of
columns by group using no copies at all, list columns, friendly and fast
character-separated-value read/write. It offers a natural and flexible
syntax, for faster development.</p>
<p>We will brief some basic <code>data.table</code> syntax that could be
used in the scenarios where <code>data.table</code> can help with the
work across data analysis in the public health field. It is the quickest
way to improve the efficiency of data pipeline in the health and social
care team. Delving into all <code>data.table</code> syntax is not our
pursuit here although it is absolutely necessary to familiarize oneself
with all <code>data.table</code> syntax to achieve a better efficiency
of scripts. For a better knowledge of <code>data.table</code>, we refer
to <a href="https://www.google.com/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=&amp;ved=2ahUKEwij657zzoyEAxVIWkEAHZMRDJEQFnoECBYQAQ&amp;url=https%3A%2F%2Fraw.githubusercontent.com%2Frstudio%2Fcheatsheets%2Fmaster%2Fdatatable.pdf&amp;usg=AOvVaw1DWM0-_fhk9Tgvu1b88YDr&amp;opi=89978449" class="external-link">R
<code>data.table</code> cheatsheet</a>, and further <a href="https://cran.r-project.org/web/packages/data.table/" class="external-link">R
<code>data.table</code> reference manual and vignettes</a>.</p>
<ul>
<li><p><code>dt[i,j,by]</code> - take data.table <strong>dt</strong>,
and for row <strong>i</strong>, manipulate columns with
<strong>j</strong>, grouped according to <strong>by</strong>.</p></li>
<li><p><code>setDT</code> or <code>as.data.table</code> - convert a data
frame or a list to a data.table.</p></li>
<li><p><code>dt[, .(x = sum(b))]</code> - create a data.table with new
columns based on the summarised values of rows. Summary functions like
<code><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean()</a></code>, <code><a href="https://rdrr.io/r/stats/median.html" class="external-link">median()</a></code>, <code><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min()</a></code>,
<code><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max()</a></code>, etc.</p></li>
<li><p><code>dt[, .(x = sum(b)), by = a]</code> - summarise rows within
groups.</p></li>
<li><p><code>dt[, c := 1+2]</code> - compute a column based on an
expression.</p></li>
<li><p><code>dt[a==1, c := 1+2]</code> - compute a column based on an
expression but only for subset of rows.</p></li>
<li><p><code>dt[, `:=`(c=1, d=2)]</code> - compute multiple columns
based on separate expressions.</p></li>
<li><p><code>dt[, c := NULL]</code> - delete a column.</p></li>
<li><p><code>dt_b[dt_a, on = .(b = y)]</code> - join data.tables on rows
with equal values, similar to
<code>left_join(dt_a, dt_b, by = c("y" = "b"))</code>.</p></li>
<li><p><code>dt_b[dt_a, on = .(b = y, c &gt; z)]</code> - join
data.tables on rows with equal and unequal values.</p></li>
<li>
<p><code>dcast(dt, id ~ y, value.var = c("a", "b"))</code> - Reshape
a data.table from long to wide format.</p>
<ul>
<li><p><code>dt</code> A data.table.</p></li>
<li><p><code>id ~ y</code> Formula with a LHS: ID columns containing IDs
for multiple entries. And a RHS columns with values to spread in column
headers.</p></li>
<li>
<p><code>value.var</code> Columns containing values to fill into
cells.</p>
<pre><code>&gt; dt
      id      y value
   &lt;num&gt; &lt;char&gt; &lt;num&gt;
1:     1      a    10
2:     1      b    20
3:     2      a    30
4:     2      b    40
5:     3      a    50
6:     3      b    60
&gt; result
Key: &lt;id&gt;
      id     a     b
    &lt;num&gt; &lt;num&gt; &lt;num&gt;
1:     1    10    20
2:     2    30    40
3:     3    50    60</code></pre>
</li>
</ul>
</li>
<li>
<p><code>melt(dt, id.vars, measure.vars, variable.name, value.name)</code>
- Reshape a data.table from wide to long format.</p>
<ul>
<li><p><code>dt</code> A data.table.</p></li>
<li><p><code>id.vars</code> ID columns with IDs for multiple
entries.</p></li>
<li><p><code>measure.vars</code> Columns containng values to fill into
cells (often in pattern form).</p></li>
<li>
<p><code>variable.name</code>, <code>value.name</code> Names of new
columns for variables and values derived from old headers.</p>
<pre><code>melt(
  dt,
  id.vars = c("id"),
  measure.vars = patterns("^a", "^b"),
  variable.name = "y",
  value.name = c("a", "b")
)
# Original data.table:
&gt; dt
      id   a_1   a_2   b_1   b_2
   &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt; &lt;num&gt;
1:     1    10    40    70   100
2:     2    20    50    80   110
3:     3    30    60    90   120
# Melted data.table:
&gt; result
      id      y     a     b
   &lt;num&gt; &lt;fctr&gt; &lt;num&gt; &lt;num&gt;
1:     1      1    10    70
2:     2      1    20    80
3:     3      1    30    90
4:     1      2    40   100
5:     2      2    50   110
6:     3      2    60   120</code></pre>
</li>
</ul>
</li>
</ul>
<hr>
</div>
<div class="section level3">
<h3 id="grouped-operations-on-large-datasets">Grouped Operations on Large Datasets<a class="anchor" aria-label="anchor" href="#grouped-operations-on-large-datasets"></a>
</h3>
<p>Manipulating grouped data with <code>dplyr</code> can be very
resource-intensive, particularly when working with grouped data. By
contrast, <code>data.table</code> can achieve a better efficiency in
terms of executing time and RAM usage. Therefore, there is a situation
where one can improve the code efficiency without much effort and time
by employing <code>data.table</code>. Here is how one can achieve
this.</p>
<div class="section level4">
<h4 id="conversion-from-dplyr-to-data-table">Conversion from <code>dplyr</code> to <code>data.table</code><a class="anchor" aria-label="anchor" href="#conversion-from-dplyr-to-data-table"></a>
</h4>
<p>We first show how one can convert <code>dplyr</code> code to the
equivalent <code>data.table</code> syntax as follows. For example, there
is a data frame called <code>height</code>, recording all students’
“height” and “gender”. Our aim is to find the maximum of “height” by
gender. The <code>dplyr</code> style and the equivalent
<code>data.table</code> style are as follows:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">height</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  gender <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Male"</span>, <span class="st">"Female"</span>, <span class="st">"Male"</span>, <span class="st">"Female"</span>, <span class="st">"Male"</span>, <span class="st">"Female"</span><span class="op">)</span>,</span>
<span>  height <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">180</span>, <span class="fl">165</span>, <span class="fl">175</span>, <span class="fl">160</span>, <span class="fl">185</span>, <span class="fl">170</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># dplyr</span></span>
<span><span class="va">max_height_df</span> <span class="op">&lt;-</span> <span class="va">height</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">gender</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>max_height <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">height</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># first transform data to data.table class</span></span>
<span><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/setDT.html" class="external-link">setDT</a></span><span class="op">(</span><span class="va">height</span><span class="op">)</span></span>
<span><span class="va">max_height_dt</span> <span class="op">&lt;-</span> <span class="va">height</span><span class="op">[</span>,</span>
<span>  <span class="fu">.</span><span class="op">(</span>max_height <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">height</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  by <span class="op">=</span> <span class="va">gender</span></span>
<span><span class="op">]</span></span>
<span><span class="co"># max_height_dt is now data.table format</span></span>
<span><span class="co"># and change it back to data.frame format if needed</span></span>
<span><span class="va">max_height_dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">max_height_dt</span><span class="op">)</span></span></code></pre></div>
<p>Both <code>dplyr</code> and <code>data.table</code> codes achieve the
same result but the latter is more efficient. In addition, always
remember setting the data to <code>data.table</code> format before
applying <code>data.table</code> package and formatting the data back to
<code>data.frame</code> for any further analysis with <code>dplyr</code>
package. In the example above, converting the <code>height</code> data
frame to a <code>data.table</code> allows us to utilize
<code>data.table</code>’s efficient operations for grouped
summaries.</p>
</div>
</div>
<div class="section level3">
<h3 id="joining-large-datasets">Joining Large Datasets<a class="anchor" aria-label="anchor" href="#joining-large-datasets"></a>
</h3>
<p>Efficient join operations are crucial for merging large datasets
seamlessly in data analysis workflows. Joining large datasets can be a
computationally intensive task, especially when using
<code>dplyr</code>’s join functions. However, <code>data.table</code>
offers optimized join operations that significantly improve efficiency.
First we will show how <code>dplyr</code> code can be transformed to
<code>data.table</code> syntax when joining large datasets. Then,
benchmark will be provide to demonstrate the efficiency and speed
improvement scale.</p>
<div class="section level4">
<h4 id="conversion-from-dplyr-to-data-table-1">Conversion from <code>dplyr</code> to <code>data.table</code><a class="anchor" aria-label="anchor" href="#conversion-from-dplyr-to-data-table-1"></a>
</h4>
<p>Consider two large datasets <code>df1</code> and <code>df2</code>,
each containing information about customers and their transactions. We
aim to join these datasets based on a common key, such as customer ID
(customer_id). Below is an example comparison of the join operation
using dplyr and its equivalent in <code>data.table</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate dummy data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">n_rows</span> <span class="op">&lt;-</span> <span class="fl">1e2</span></span>
<span></span>
<span><span class="co"># Creating first dataset</span></span>
<span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  customer_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n_rows</span> <span class="op">*</span> <span class="fl">10</span><span class="op">)</span>, <span class="va">n_rows</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  transaction_amount <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n_rows</span>, min <span class="op">=</span> <span class="fl">10</span>, max <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Creating second dataset</span></span>
<span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  customer_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n_rows</span> <span class="op">*</span> <span class="fl">10</span><span class="op">)</span>, <span class="va">n_rows</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  customer_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"Customer_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">n_rows</span> <span class="op">*</span> <span class="fl">10</span><span class="op">)</span>, <span class="va">n_rows</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Joining with dplyr</span></span>
<span><span class="va">joined_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">df1</span>, <span class="va">df2</span>, by <span class="op">=</span> <span class="st">"customer_id"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">customer_id</span>, <span class="va">transaction_amount</span>, <span class="va">customer_name</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">customer_id</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Converting to data.table</span></span>
<span><span class="va">dt1</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">df1</span><span class="op">)</span></span>
<span><span class="va">dt2</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">df2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Joining with data.table</span></span>
<span><span class="va">joined_dt</span> <span class="op">&lt;-</span> <span class="va">dt2</span><span class="op">[</span><span class="va">dt1</span>, on <span class="op">=</span> <span class="st">"customer_id"</span><span class="op">]</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">customer_id</span>, <span class="va">transaction_amount</span>, <span class="va">customer_name</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">customer_id</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span><span class="va">joined_df</span>, <span class="va">joined_dt</span><span class="op">)</span></span>
<span><span class="co"># TRUE</span></span></code></pre></div>
<p>In the following we demonstrate equivalent code for various join
types using both <code>dplyr</code> and <code>data.table</code>. Each
join type — left, right, full, inner, anti, and semi — serves different
purposes in merging datasets based on a common key. For instance, a full
join retains all rows from both datasets, while an inner join only
includes rows with matching keys in both datasets. The left and right
joins prioritize rows from one dataset while retaining unmatched rows
from the other. In contrast, anti joins exclude rows with matching keys,
while semi joins include only rows with at least one match. By providing
equivalent code snippets for each join type in both dplyr and
data.table, we aim to illustrate the flexibility and efficiency of both
packages in handling various join scenarios, allowing users to choose
the approach that best fits their specific requirements.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># left join</span></span>
<span><span class="va">joined_df_left</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">df1</span>, <span class="va">df2</span>, by <span class="op">=</span> <span class="st">"customer_id"</span><span class="op">)</span></span>
<span><span class="va">joined_dt_left1</span> <span class="op">&lt;-</span> <span class="va">dt2</span><span class="op">[</span><span class="va">dt1</span>, on <span class="op">=</span> <span class="st">"customer_id"</span><span class="op">]</span></span>
<span><span class="va">joined_dt_left2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">dt1</span>, <span class="va">dt2</span>, by <span class="op">=</span> <span class="st">"customer_id"</span>, all.x <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># right join</span></span>
<span><span class="va">joined_df_right</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">right_join</a></span><span class="op">(</span><span class="va">df1</span>, <span class="va">df2</span>, by <span class="op">=</span> <span class="st">"customer_id"</span><span class="op">)</span></span>
<span><span class="va">joined_dt_right1</span> <span class="op">&lt;-</span> <span class="va">dt1</span><span class="op">[</span><span class="va">dt2</span>, on <span class="op">=</span> <span class="st">"customer_id"</span><span class="op">]</span></span>
<span><span class="va">joined_dt_rigth2</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">dt1</span>, <span class="va">dt2</span>, by <span class="op">=</span> <span class="st">"customer_id"</span>, all.y <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># inner join</span></span>
<span><span class="va">joined_df_inner</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">inner_join</a></span><span class="op">(</span><span class="va">df1</span>, <span class="va">df2</span>, by <span class="op">=</span> <span class="st">"customer_id"</span><span class="op">)</span></span>
<span><span class="va">joined_dt_inner1</span> <span class="op">&lt;-</span> <span class="va">dt1</span><span class="op">[</span><span class="va">dt2</span>, on <span class="op">=</span> <span class="st">"customer_id"</span>, nomatch <span class="op">=</span> <span class="cn">NULL</span><span class="op">]</span></span>
<span><span class="va">joined_dt_inner2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">dt1</span>,</span>
<span>  <span class="va">dt2</span>,</span>
<span>  by <span class="op">=</span> <span class="st">"customer_id"</span>,</span>
<span>  all.x <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  all.y <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># full join</span></span>
<span><span class="va">joined_df_full</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">full_join</a></span><span class="op">(</span><span class="va">df1</span>, <span class="va">df2</span>, by <span class="op">=</span> <span class="st">"customer_id"</span><span class="op">)</span></span>
<span><span class="va">joined_dt_full2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">dt1</span>, <span class="va">dt2</span>, by <span class="op">=</span> <span class="st">"customer_id"</span>, all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># anti join</span></span>
<span><span class="va">joined_df_anti</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html" class="external-link">anti_join</a></span><span class="op">(</span><span class="va">df1</span>, <span class="va">df2</span>, by <span class="op">=</span> <span class="st">"customer_id"</span><span class="op">)</span></span>
<span><span class="va">joined_dt_anti1</span> <span class="op">&lt;-</span> <span class="va">dt1</span><span class="op">[</span><span class="op">!</span><span class="va">dt2</span>, on <span class="op">=</span> <span class="st">"customer_id"</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># semi join</span></span>
<span><span class="va">joined_df_semi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html" class="external-link">semi_join</a></span><span class="op">(</span><span class="va">df1</span>, <span class="va">df2</span>, by <span class="op">=</span> <span class="st">"customer_id"</span><span class="op">)</span></span>
<span><span class="va">joined_dt_semi1</span> <span class="op">&lt;-</span> <span class="va">dt1</span><span class="op">[</span><span class="va">dt2</span>,</span>
<span>  on <span class="op">=</span> <span class="st">"customer_id"</span>,</span>
<span>  nomatch <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  <span class="fu">.</span><span class="op">(</span><span class="va">customer_id</span>, <span class="va">transaction_amount</span><span class="op">)</span></span>
<span><span class="op">]</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="reshaping-data">Reshaping Data<a class="anchor" aria-label="anchor" href="#reshaping-data"></a>
</h3>
<p>Reshaping data refers to the process of restructuring or reorganizing
the layout of a dataset. This typically involves converting data from
one format to another to make it more suitable for analysis or
presentation. Reshaping often involves tasks such as:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Changing the layout of data:</strong> This includes tasks
like converting data from wide to long format or vice versa. In the wide
format, each observation is represented by a single row, and different
variables are stored in separate columns. In the long format, each
observation is represented by multiple rows, and different values of
variables are stored in a single column along with an identifier
variable to distinguish them.</p></li>
<li><p><strong>Pivoting or melting data:</strong> Pivoting involves
rotating the data from a tall, thin format to a wide format, typically
by converting unique values in a column to separate columns. Melting, on
the other hand, involves converting multiple columns into key-value
pairs, often for easier aggregation or analysis.</p></li>
</ol>
<p>Overall, reshaping data is an important step in data preprocessing
and analysis, as it helps to organize data in a way that facilitates
efficient analysis, visualization, and interpretation. Libraries like
<code>dplyr</code> and <code>data.table</code> in R provide powerful
tools for reshaping data, making it easier to perform these tasks
programmatically.</p>
<div class="section level4">
<h4 id="conversion-from-dplyr-to-data-table-2">Conversion from <code>dplyr</code> to <code>data.table</code><a class="anchor" aria-label="anchor" href="#conversion-from-dplyr-to-data-table-2"></a>
</h4>
<p>We demonstrate how to convert data between wide-format and
long-format representations using both <code>dplyr</code> and
<code>data.table</code>. Each package provides functions
(<code><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer()</a></code> and <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider()</a></code> in
<code>dplyr</code>, <code><a href="https://rdatatable.gitlab.io/data.table/reference/melt.data.table.html" class="external-link">melt()</a></code> and <code><a href="https://rdatatable.gitlab.io/data.table/reference/dcast.data.table.html" class="external-link">dcast()</a></code> in
<code>data.table</code>) that streamline the conversion process,
allowing for flexible and efficient manipulation of data structures.</p>
<div class="section level5">
<h5 class="unnumbered" id="wide-to-long-format">Wide to long format<a class="anchor" aria-label="anchor" href="#wide-to-long-format"></a>
</h5>
<p>The equivalent functions for formatting data from wide to long format
of <code>dplyr</code> and <code>data.table</code> are
<code>pivot_wider</code> and <code>dcast</code> respectively.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="co"># Example long-format data frame</span></span>
<span><span class="va">long_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  key1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"B"</span>, <span class="st">"C"</span><span class="op">)</span>,</span>
<span>  key2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"W"</span>, <span class="st">"W"</span>, <span class="st">"X"</span>, <span class="st">"X"</span>, <span class="st">"Y"</span><span class="op">)</span>,</span>
<span>  variable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"value1"</span>, <span class="st">"value2"</span>, <span class="st">"value1"</span>, <span class="st">"value2"</span>, <span class="st">"value1"</span><span class="op">)</span>,</span>
<span>  value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">100</span>, <span class="fl">20</span>, <span class="fl">200</span>, <span class="fl">30</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert to wide format using dplyr</span></span>
<span><span class="va">wide_df</span> <span class="op">&lt;-</span> <span class="va">long_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span></span>
<span>    names_from <span class="op">=</span> <span class="va">variable</span>,</span>
<span>    values_from <span class="op">=</span> <span class="va">value</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">long_dt</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">long_df</span><span class="op">)</span></span>
<span><span class="va">wide_dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/dcast.data.table.html" class="external-link">dcast</a></span><span class="op">(</span><span class="va">long_dt</span>,</span>
<span>  <span class="va">ID</span> <span class="op">+</span> <span class="va">key1</span> <span class="op">+</span> <span class="va">key2</span> <span class="op">~</span> <span class="va">variable</span>,</span>
<span>  value.var <span class="op">=</span> <span class="st">"value"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level5">
<h5 class="unnumbered" id="long-to-wide-format">Long to wide format<a class="anchor" aria-label="anchor" href="#long-to-wide-format"></a>
</h5>
<p>The equivalent functions for formatting data from long to wide format
of <code>dplyr</code> and <code>data.table</code> are
<code>pivot_longer</code> and <code>melt</code> respectively.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="co"># Example wide-format data frame</span></span>
<span><span class="va">wide_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  ID <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,</span>
<span>  key1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"D"</span>, <span class="st">"E"</span><span class="op">)</span>,</span>
<span>  key2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"W"</span>, <span class="st">"X"</span>, <span class="st">"Y"</span>, <span class="st">"Z"</span>, <span class="st">"V"</span><span class="op">)</span>,</span>
<span>  value1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">20</span>, <span class="fl">30</span>, <span class="fl">40</span>, <span class="fl">50</span><span class="op">)</span>,</span>
<span>  value2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">200</span>, <span class="fl">300</span>, <span class="fl">400</span>, <span class="fl">500</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert to long format using dplyr</span></span>
<span><span class="va">long_df</span> <span class="op">&lt;-</span> <span class="va">wide_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"value"</span><span class="op">)</span>,</span>
<span>    names_to <span class="op">=</span> <span class="st">"variable"</span>,</span>
<span>    values_to <span class="op">=</span> <span class="st">"value"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">wide_dt</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">wide_df</span><span class="op">)</span></span>
<span><span class="va">long_dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/melt.data.table.html" class="external-link">melt</a></span><span class="op">(</span></span>
<span>  <span class="va">wide_dt</span>,</span>
<span>  id.vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"ID"</span>, <span class="st">"key1"</span>, <span class="st">"key2"</span><span class="op">)</span>,</span>
<span>  measure.vars <span class="op">=</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/patterns.html" class="external-link">patterns</a></span><span class="op">(</span><span class="st">"^value"</span><span class="op">)</span>,</span>
<span>  variable.name <span class="op">=</span> <span class="st">"variable"</span>,</span>
<span>  value.name <span class="op">=</span> <span class="st">"value"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>In these examples, the long-format data is converted into wide format
using the <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider()</a></code> function from <code>dplyr</code>
and the <code><a href="https://rdatatable.gitlab.io/data.table/reference/dcast.data.table.html" class="external-link">dcast()</a></code> function from <code>data.table</code>. This
reshaping operation allows for easier analysis and visualization of the
data in a wider format.</p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="conditional-updates">Conditional Updates<a class="anchor" aria-label="anchor" href="#conditional-updates"></a>
</h3>
<p>Conditional updates refer to the process of modifying values in a
dataset based on specified conditions. In other words, it involves
updating certain values in a dataset only if they meet specific criteria
or conditions. This can be particularly useful when you need to apply
changes to a dataset selectively, depending on the values of certain
variables or combinations of variables. For instance, one might want to
update the values in a column based on whether they meet certain
thresholds, or one might want to apply different transformations to
different subsets of your data based on some criteria. Conditional
updates allow one to automate these modifications efficiently, saving
time and effort compared to manual editing.</p>
<div class="section level4">
<h4 id="conversion-from-dplyr-to-data-table-3">Conversion from <code>dplyr</code> to <code>data.table</code><a class="anchor" aria-label="anchor" href="#conversion-from-dplyr-to-data-table-3"></a>
</h4>
<p>Both <code>dplyr</code> and <code>data.table</code> provide
functionality for performing conditional updates, allowing you to
implement complex data transformations with ease. These operations are
often performed using functions like <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate()</a></code> in
<code>dplyr</code> and <code>:=</code> in <code>data.table</code>, along
with logical conditions to specify when the updates should occur.</p>
<p>Suppose we have a dataset containing information about students’ exam
scores, and we want to update the scores based on certain conditions.
Let’s consider a scenario where we want to increase the scores of
students who scored below a certain threshold. In this
<code>dplyr</code> example, we use the <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate()</a></code> function to
update the <code>exam_score</code> column based on the condition
specified inside <code><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse()</a></code>. If the <code>exam_score</code>
is below 70, we increase it by 5; otherwise, we keep it unchanged. In
the <code>data.table</code> example, we use the <code>:=</code> operator
to update the <code>exam_score</code> column directly within the
dataset. The logical condition <code>exam_score &lt; 70</code> is used
to specify which rows should be updated, and the expression
<code>exam_score + 5</code> is used to define the new values for those
rows. Both approaches achieve the same result: updating exam scores for
students who scored below 70. However, they differ in syntax and
implementation, showcasing the flexibility of both <code>dplyr</code>
and <code>data.table</code> for performing conditional updates.
Similarly, <code><a href="https://rdatatable.gitlab.io/data.table/reference/fcase.html" class="external-link">data.table::fcase()</a></code> is the equivalent version to
<code><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">dplyr::case_when()</a></code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span>
<span><span class="co"># Dummy dataset</span></span>
<span><span class="va">scores_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  student_id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,</span>
<span>  exam_score <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">75</span>, <span class="fl">82</span>, <span class="fl">65</span>, <span class="fl">90</span>, <span class="fl">55</span>, <span class="fl">78</span>, <span class="fl">70</span>, <span class="fl">85</span>, <span class="fl">60</span>, <span class="fl">72</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># Increase scores for students with scores below 70</span></span>
<span><span class="va">updated_scores_df</span> <span class="op">&lt;-</span> <span class="va">scores_df</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>exam_score <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">exam_score</span> <span class="op">&lt;</span> <span class="fl">70</span>, <span class="va">exam_score</span> <span class="op">+</span> <span class="fl">5</span>, <span class="va">exam_score</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert to data.table</span></span>
<span><span class="va">scores_dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/as.data.table.html" class="external-link">as.data.table</a></span><span class="op">(</span><span class="va">scores_df</span><span class="op">)</span></span>
<span><span class="co"># Increase scores for students with scores below 70</span></span>
<span><span class="va">scores_dt</span><span class="op">[</span><span class="va">exam_score</span> <span class="op">&lt;</span> <span class="fl">70</span>, <span class="va">exam_score</span> <span class="op">:=</span> <span class="va">exam_score</span> <span class="op">+</span> <span class="fl">5</span><span class="op">]</span></span>
<span><span class="va">scores_dt</span><span class="op">[</span>, <span class="va">exam_score</span> <span class="op">:=</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fifelse.html" class="external-link">fifelse</a></span><span class="op">(</span><span class="va">exam_score</span> <span class="op">&lt;</span> <span class="fl">70</span>, <span class="va">exam_score</span> <span class="op">+</span> <span class="fl">5</span>, <span class="va">exam_score</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">scores_dt</span><span class="op">[</span>, <span class="va">exam_score</span> <span class="op">:=</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/fcase.html" class="external-link">fcase</a></span><span class="op">(</span><span class="va">exam_score</span> <span class="op">&lt;</span> <span class="fl">70</span>, <span class="va">exam_score</span> <span class="op">+</span> <span class="fl">5</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="concluding-remarks">Concluding Remarks<a class="anchor" aria-label="anchor" href="#concluding-remarks"></a>
</h2>
<p><code>data.table</code> can provide a great improvement in efficiency
using its native syntax. I also noticed that there are R packages that
can allow one to write dplyr code that is automatically translated to
the equivalent <code>data.table</code> code, e.g. <code>dtplyr</code>
and <code>tidytable</code>. However, after testing, those packages does
not produce much improvement in grouped operations, which is the main
scenario in the SLF. In addition, I also notice an emerging package <a href="https://github.com/pola-rs/r-polars" class="external-link"><code>polars</code></a> and
its friend <a href="https://github.com/etiennebacher/tidypolars/" class="external-link"><code>tidypolars</code></a>
which are developed with Rust. I aim to apply those packages when R v4.4
is available to PHS.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Public Health Scotland, Megan McNicol, Jennifer Thom, Zihao Li.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
